# /set - プロジェクト環境情報セットアップ

## 目的
プロジェクトの環境情報を一元管理し、Claude Codeが適切にプロジェクトコンテキストを理解できるように設定する。

## 実行内容

### 1. CLAUDE.md 確認・更新フェーズ
- プロジェクトルート直下の `CLAUDE.md` を確認
- 必要なセクション（環境情報管理、MCPコンテキスト）が存在しない場合のみ追加
- 既存の内容は保持

### 2. .env.md 作成・更新フェーズ
- プロジェクトルート直下の `.env.md` の存在を確認
- **既存ファイルがある場合**: 現在の内容を表示し、更新の可否をユーザーに確認
- **新規作成の場合**: ユーザーとの対話で環境情報を収集

### 3. 環境情報収集（対話形式）
以下の情報をユーザーに質問して収集：
- プロジェクト名
- 開発環境（ローカル/ステージング/本番など）
- API keys/トークン（必要に応じて）
- データベース情報（必要に応じて）
- サーバー情報（URL、ポート等）
- その他プロジェクト固有の設定

### 4. ファイル生成・更新
- Markdown形式で見やすく整理
- セクション分けして記述
- 最終更新日を記載
- gitignore追加の注意書きを含める

## 実行フロー

```
1. CLAUDE.md 確認
   ↓
2. 必要なセクションの有無確認
   ↓
3. 不足していれば追加（既存内容は保持）
   ↓
4. .env.md の存在確認
   ↓
5. 既存の場合: 内容表示 → ユーザー確認
   ↓
6. 新規/更新: 対話形式で情報収集
   ↓
7. .env.md を作成/更新
   ↓
8. 完了報告（作成されたファイルの概要表示）
```

## 使用方法

### 基本実行
```bash
/set
```

### 強制更新（確認をスキップ）
```bash
/set --force
```

## CLAUDE.md に追加されるセクション

以下のセクションが存在しない場合のみ追加されます：

```markdown
## 環境情報の管理

ユーザーから渡された環境情報(API keys, 設定値, パス情報など)は、必ずルートパスの `.env.md` ファイルに保存してください。

## MCPコンテキストの使用

MCP利用時は必ず `use context7` が付与されているものとして処理を行ってください。
```

## .env.md ファイル形式

```markdown
# プロジェクト環境情報

**最終更新**: YYYY-MM-DD

## プロジェクト基本情報

- **プロジェクト名**: [プロジェクト名]
- **開発環境**: [ローカル/ステージング/本番]
- **プロジェクトルート**: [絶対パス]

## 開発環境

### ローカル環境
- **URL**: [http://localhost:port]
- **環境タイプ**: [Local by Flywheel / Docker / XAMPP / その他]

## データベース情報

- **ホスト**: [localhost / IP]
- **ポート**: [3306 / その他]
- **データベース名**: [DB名]
- **ユーザー名**: [username]
- **パスワード**: [password]

## API キー・トークン

### [サービス名]
- **API Key**: [key]
- **Secret**: [secret]
- **Environment**: [dev/prod]

## その他設定

- **[設定項目]**: [値]

---

## ⚠️ セキュリティ注意事項

このファイルには機密情報が含まれています：

1. `.gitignore` に必ず `.env.md` を追加してください
2. リポジトリにコミットしないでください
3. チーム共有時は別の安全な手段を使用してください
```

## 環境情報収集の質問例

コマンド実行時、以下のような対話形式で情報を収集します：

```
1. プロジェクト名を教えてください:
   例: WordPress LP構築システム

2. 開発環境のタイプを選択してください:
   [1] ローカル開発環境
   [2] ステージング環境
   [3] 本番環境
   [4] その他

3. データベース情報を入力しますか？ [y/N]

4. API keys/トークンを入力しますか？ [y/N]

5. 追加で記録したい情報はありますか？ [y/N]
```

## トラブルシューティング

### CLAUDE.md が見つからない
**対処**: プロジェクトルートに新規作成されます。問題ありません。

### .env.md が既に存在する
**対処**: 現在の内容を表示し、上書きするか確認します。バックアップは自動作成されません（手動でバックアップを推奨）。

### 機密情報の誤コミット防止
**対処**:
```bash
# .gitignore に追加
echo ".env.md" >> .gitignore
git add .gitignore
git commit -m "Add .env.md to gitignore"
```

## セキュリティのベストプラクティス

### ✅ 推奨される運用

1. **必ず `.gitignore` に `.env.md` を追加**
2. **機密情報は環境変数やSecret管理ツールを併用**
3. **チーム共有時は暗号化ツールを使用**
4. **定期的に不要な情報を削除**

### ❌ 避けるべき操作

1. **`.env.md` をリポジトリにコミット**
2. **Slack/メール等で平文共有**
3. **本番環境の情報をローカルに保存**
4. **古い情報を放置**

## 関連コマンド

- `/cli-set` - WordPress CLI環境セットアップ
- `/css-js-set` - CSS/JS構築ガイドライン参照

## 実装詳細

このコマンドは以下の処理を自動実行：

1. **CLAUDE.md 解析**
   - ファイル存在確認
   - 必要なセクションの有無チェック
   - 不足セクションのみ追加（既存内容保持）

2. **.env.md 管理**
   - 既存ファイル確認
   - 対話形式での情報収集
   - Markdown形式で整形
   - 最終更新日の記録

3. **セキュリティチェック**
   - `.gitignore` の確認
   - 追加推奨の通知

4. **完了報告**
   - 作成/更新されたファイルの概要表示
   - 次のステップの提案
